# Node-RED and DuckDB

<img src="https://github.com/w3point0/node-red-duckdb/assets/993459/650c9b19-74f0-448d-9f51-27b057c2d9fb" width="50%" height="50%">  

>Definition: A Silent SIP refers to a micro YouTube video characterized by the absence of spoken dialogue, relying solely on visual actions and written commentary. Designed for viewers who prefer concise, straightforward examples without lengthy explanations, it serves those already familiar with the subject matter or those seeking to uncover subtle hints. This format embodies the concept of incremental knowledge—Kaizen—in a silent yet impactful manner.


>Node-RED and DuckDB have become an exceptional combination, allowing the use of quick coding techniques to configure, cache, and modify flows dynamically. This synergy facilitates a seamless transition from rapid prototyping to production, simplifying the development process. With AI snippets, you can also store WASM files generated by Go, Rust, C, C++, and more, adding a robust layer of functionality to your workflows. 

## Environment
- Node v20.12.1  
- Node-RED v3.8.1  
- Ubuntu 22.04.3 LTS

# Setup DuckDB with No-Code Package Version Latest

### The Flow  
![image](https://github.com/w3point0/node-red-duckdb/assets/993459/3dba7b67-8163-4dde-acea-188b61fb5058)

#### Setup  **Get/ DuckDB** 
![image](https://github.com/w3point0/node-red-duckdb/assets/993459/5f7386e6-0553-4bd5-a3d7-d4a1aa28d792)  

![image](https://github.com/w3point0/node-red-duckdb/assets/993459/b545d2a7-8785-4765-9f9b-415f9790c309)  

![image](https://github.com/w3point0/node-red-duckdb/assets/993459/d94ebb76-58ba-40c8-93b4-99be4ea6571a)

![image](https://github.com/w3point0/node-red-duckdb/assets/993459/03a5caa2-9e00-4f85-813f-bc15028e4b6d)

![image](https://github.com/w3point0/node-red-duckdb/assets/993459/aba706a8-5697-4bc5-b554-bf4ceeec36e5)


#### Prepared SQL Statement  
![image](https://github.com/w3point0/node-red-duckdb/assets/993459/ccd40131-36ae-4e98-a732-026160b25e08)  
![image](https://github.com/w3point0/node-red-duckdb/assets/993459/04c82819-31ce-444b-a106-a6d8c025cd89)

### Response 
![image](https://github.com/w3point0/node-red-duckdb/assets/993459/6027a6a8-57a7-41ae-b822-98a7a7563791)  
![image](https://github.com/w3point0/node-red-duckdb/assets/993459/86983bbe-ec9e-4e4e-8579-2ca374088288)  

### Copy and Paste the Code
That's it folks.

You can copy and paste this code to try it yourself. Happy Visual Coding!

> All Javascript code has been generated by ChatGPT.
![image](https://github.com/w3point0/node-red-duckdb/assets/993459/25cfe896-ef49-4396-98ef-2c82f0ebee05)


```
[
    {
        "id": "b0b08215ec18023f",
        "type": "tab",
        "label": "DuckDB Demo",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "103c148028ec5ce9",
        "type": "group",
        "z": "b0b08215ec18023f",
        "name": "Response",
        "style": {
            "label": true
        },
        "nodes": [
            "f57825b6b5ae5b85",
            "f755ca17a930136d"
        ],
        "x": 74,
        "y": 399,
        "w": 492,
        "h": 82
    },
    {
        "id": "5d3acbe7571e32c6",
        "type": "group",
        "z": "b0b08215ec18023f",
        "name": "Setup",
        "style": {
            "label": true
        },
        "nodes": [
            "10f8ec49d290906f",
            "ce2b7cd6bf125293"
        ],
        "x": 74,
        "y": 99,
        "w": 452,
        "h": 82
    },
    {
        "id": "e0fa50cbb46b7a95",
        "type": "group",
        "z": "b0b08215ec18023f",
        "name": "Prepared SQL Statement",
        "style": {
            "label": true
        },
        "nodes": [
            "70d7e4a8ce02d25c"
        ],
        "x": 74,
        "y": 239,
        "w": 312,
        "h": 82
    },
    {
        "id": "9310cf5c61848e0e",
        "type": "catch",
        "z": "b0b08215ec18023f",
        "name": "Catch on All nodes",
        "scope": null,
        "uncaught": false,
        "x": 170,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "10f8ec49d290906f",
        "type": "function",
        "z": "b0b08215ec18023f",
        "g": "5d3acbe7571e32c6",
        "name": "On Start - Load DuckDB",
        "func": "return msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "var database = new duckdb.Database(':memory:');\ndatabase = database.connect()\nglobal.set('db', database)\n\n\n",
        "finalize": "",
        "libs": [
            {
                "var": "duckdb",
                "module": "duckdb"
            }
        ],
        "x": 390,
        "y": 140,
        "wires": [
            [
                "70d7e4a8ce02d25c"
            ]
        ]
    },
    {
        "id": "ce2b7cd6bf125293",
        "type": "http in",
        "z": "b0b08215ec18023f",
        "g": "5d3acbe7571e32c6",
        "name": "GET /duckdb",
        "url": "/duckdb",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 140,
        "wires": [
            [
                "10f8ec49d290906f"
            ]
        ],
        "info": "Magic Is Real"
    },
    {
        "id": "f57825b6b5ae5b85",
        "type": "http response",
        "z": "b0b08215ec18023f",
        "g": "103c148028ec5ce9",
        "name": "HTTP Response",
        "statusCode": "",
        "headers": {
            "content-type": "text/html"
        },
        "x": 460,
        "y": 440,
        "wires": []
    },
    {
        "id": "70d7e4a8ce02d25c",
        "type": "function",
        "z": "b0b08215ec18023f",
        "g": "e0fa50cbb46b7a95",
        "name": "Prepared Statment/ Insert Data",
        "func": "global.get(\"db\").run('CREATE TABLE a (i INTEGER)');\nvar stmt = global.get(\"db\").prepare('INSERT INTO a VALUES (?)');\nfor (var i = 0; i < 10; i++) {\n  stmt.run(i);\n}\nstmt.finalize();\n\nglobal.get(\"db\").all('SELECT * FROM a', function(err, res) {\n  if (err) {\n    console.warn(err);\n  }\n  msg.payload.dbresults = JSON.stringify(res)\n  node.send(msg)\n});\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 280,
        "wires": [
            [
                "f755ca17a930136d"
            ]
        ]
    },
    {
        "id": "f755ca17a930136d",
        "type": "template",
        "z": "b0b08215ec18023f",
        "g": "103c148028ec5ce9",
        "name": "Mustache Template Output",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "DuckDB Snapshot: {{payload.dbresults}} !",
        "output": "str",
        "x": 220,
        "y": 440,
        "wires": [
            [
                "f57825b6b5ae5b85"
            ]
        ]
    }
]
```


---
Extra Information

# Setup DuckDB Set Package Version


## Install Duck DB into the .node-red directory

Step 1: cd into your home directory.

You will see the .node-red.

Step 2: cd into .node-red

```
cd ~/.node-red
```

![image](https://github.com/w3point0/node-red-duckdb/assets/993459/1044b0b0-71ba-4f37-a44a-ee401dfe6e54)


Step 3: Install DuckDB

![image](https://github.com/w3point0/node-red-duckdb/assets/993459/043095d5-88e9-441f-95ef-e95ae9862c47)

Note: We could have configured DuckDB during the setup phase. However, unfortunately, this defaults to the latest version. To specify a version, we need to set it up in both `package.json` and `settings.js`.

```
npm install duckdb@0.10.1 --save
```
Done!

## Modify Your settings.js File

Step: 1 Add your favorite node package. For this example a simple word-to-number package will be used.
```
vi settings.js
```

![image](https://github.com/w3point0/node-red-duckdb/assets/993459/1636216d-f875-473a-b54a-63003b4d52ad)

Step 2: Restart node-red
You will now be able to use this package. 

Done!


